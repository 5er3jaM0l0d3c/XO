<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Крестики-нолики</title>
</head>
<body>
    <p style="text-align:center;vertical-align:central">
        <h4>Введите никнейм:</h4>
        <input id="nickname" type="text" />
        <button id="startButton">Начать игру</button>
    </p>

    <script src="https://cdn.jsdelivr.net/npm/@microsoft/signalr/dist/browser/signalr.min.js"></script>
    <script src="js/SignalRConnection.js"></script>
    <script>



        let btn = document.getElementById("startButton");
        btn.addEventListener("click", async function () {
            if (isConnected) {
                const response = await fetch("/api/setplayer?player=" + document.getElementById("nickname").value, {
                    method: "POST",
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    }

                });
                if (response.ok === true) {
                    const data = await response.json();
                    if (data.success === true) {
                        sessionStorage.setItem("name", document.getElementById("nickname").value);
                        sessionStorage.setItem("id", data.id);


                        connection.invoke("SendNotWaiting", sessionStorage.getItem("name")).then(console.log("запрос")).catch(err => {
                            console.error(err.toString());
                        });

                        connection.invoke("SendLog", sessionStorage.getItem("name") + " : ввел никнейм").catch(err => {
                            console.error(err.toString());
                        });

                        document.location.href = "game.html";
                    }
                    else {
                        connection.invoke("SendLog", sessionStorage.getItem("name") + " : алерт о невозможности игры").catch(err => {
                            console.error(err.toString());
                        });
                        alert("Такой никнейм уже используется или уже зарегистрированы 2 игрока");
                    }
                }
            }
            else {
                alert("Подключение не было установлено, попробуйте ещё раз через пару секунд");
            }
            
        })

    </script>
</body>
</html>